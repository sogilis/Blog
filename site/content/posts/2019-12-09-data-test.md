---
title: How to test your DOM by being resilient to design changes ?
author: alban@sogilis.com
date: 2019-12-09
image: /img/2019/12/data-test.jpeg
categories:
  - DÉVELOPPEMENT
tags:
  - Js
  - VueJs
  - Jest
  - test

---
*For the article the technical stack used is VueJs front-end framework and Jest testing framework*

## Let’s introduce the problem by an example

We have a button to go to the previous page.

{{< highlight html >}}
<div class="btn-arrow" @click="goToPreviousPage">
    Back
</div>
{{< /highlight >}}

And the unit test:
{{< highlight js >}}
it('goes to the previous page when back button is clicked', () => {
	// mock goToPreviousPage method
	wrapper.vm.goToPreviousPage = jest.fn()

    wrapper.find('.btn-arrow').trigger('click')

	expect(wrapper.vm.goToPreviousPage).toHaveBeenCalled()
})
{{< /highlight >}}

Now we want to change the design by replacing <code>.btn-arrow</code> to <code>.btn-link</code> class.  
Of course, it’s an example and in the real world design can change also
by adding tag like <code>div</code>, <code>a</code>, <code>span</code> etc.

{{< highlight html >}}
<div class=".btn-link" @click="goToPreviousPage">
	Back
</div>
{{< /highlight >}}

But now, our test is red because the css selector is *undefined* while the functionality still works.

## Solution 
The solution to be resilient to this kind of changes is to introduce HTML <code>data-*</code> attributes in your DOM.

Let’s take the W3C definition:  

* The <code>data-*</code> attributes is used to store custom data private to the page or application. 

We can add to our HTML a <code>data-test</code> attribute to test our DOM.

{{< highlight html >}}
<div class=".btn-link" data-test-action="previous-page" @click="goToPreviousPage">
	Back
</div>
{{< /highlight >}}

{{< highlight js >}}
it('goes to the previous page when back button is clicked', () => {
    // mock goToPreviousPage method
	wrapper.vm.goToPreviousPage = jest.fn()

    wrapper.find('[data-test-action="previous-page"]').trigger(‘click’)

	expect(wrapper.vm.goToPreviousPage).toHaveBeenCalled()
})
{{< /highlight >}}


Now our unit test has become resilient to design changes because we used data attribute as css selector. 

## This tip has some negative points

* Bigger HTML, degraded readability.  
* Take time to add data attributes.

**Alban Bertolini**

Special thanks to Jean-Baptiste, Yann, Nasser and Julio for their feedbacks.
